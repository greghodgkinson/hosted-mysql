app = 'hosted-mysql'
primary_region = 'iad'

# Use the official MySQL 8 container image
[build]
  image = 'mysql:8.0.37'

# Run MySQL and force legacy (native) password auth for compatibility
[processes]
  # Use the official image entrypoint so it initializes users/db from env vars,
  # and bind to 0.0.0.0 so fly-proxy can reach it on 3306.
  app = "/usr/local/bin/docker-entrypoint.sh mysqld --default-authentication-plugin=mysql_native_password --bind-address=0.0.0.0"

# Environment variables for MySQL initialization
# (Passwords are in plain text; this is fine for testing but not recommended for production)
[env]
  MYSQL_DATABASE      = "test_db"
  MYSQL_USER          = "db_user"
  MYSQL_PASSWORD      = "db_password"
  MYSQL_ROOT_PASSWORD = "root_password"

# Expose the MySQL port publicly so external clients can connect directly
[[services]]
  internal_port = 3306
  protocol = "tcp"
  processes = ["app"]
  [[services.ports]]
    port = 3306

  [[services.tcp_checks]]
    interval = "15s"
    timeout  = "2s"

# Optional VM sizing
[[vm]]
  memory   = '1gb'
  cpu_kind = 'shared'
  cpus     = 1